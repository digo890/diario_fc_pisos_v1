import{r as n,O as r,j as e,X as p,f as R,T as D,B as k,I as j,P as U,Q as L,S as O,U as T,V as A,W as $}from"./index-B8AJ77RJ.js";import{C as m}from"./circle-check-big-B6tA49Jg.js";import{T as B}from"./trash-2-BZuJ-7VK.js";import"./react-vendor-7PqXWhc5.js";function K({isOpen:x,onClose:N}){const[h,y]=n.useState([]),[a,f]=n.useState(null),[s,g]=n.useState(null),[c,v]=n.useState(!1),i=async()=>{const t=U();y(t);const d=await L();f(d)};n.useEffect(()=>{x&&i()},[x]),n.useEffect(()=>{if(!c)return;const t=setInterval(i,5e3);return()=>clearInterval(t)},[c]);const w=()=>{confirm("Deseja realmente limpar todos os erros registrados?")&&($(),y([]),g(null))},E=()=>{const t=T(),d=new Blob([t],{type:"application/json"}),l=URL.createObjectURL(d),o=document.createElement("a");o.href=l,o.download=`production-errors-${Date.now()}.json`,o.click(),URL.revokeObjectURL(l)},S=()=>{const t=A(),d=new Blob([t],{type:"text/csv"}),l=URL.createObjectURL(d),o=document.createElement("a");o.href=l,o.download=`production-errors-${Date.now()}.csv`,o.click(),URL.revokeObjectURL(l)},C=()=>{const t=O();alert(t)};if(!x)return null;const b={[r.EDGE_FUNCTION]:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",[r.AUTH]:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400",[r.RLS]:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400",[r.QUERY]:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",[r.SECRET]:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",[r.NETWORK]:"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400",[r.UNKNOWN]:"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400"},u={[r.EDGE_FUNCTION]:"ðŸ”¥",[r.AUTH]:"ðŸ”",[r.RLS]:"ðŸ›¡ï¸",[r.QUERY]:"ðŸ“Š",[r.SECRET]:"ðŸ”‘",[r.NETWORK]:"ðŸŒ",[r.UNKNOWN]:"â“"};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"ðŸš¨ Monitor de ProduÃ§Ã£o"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Detecta e diagnostica erros de Edge Functions, Auth, RLS, Queries e mais"})]}),e.jsx("button",{onClick:N,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400",children:e.jsx(p,{className:"w-6 h-6"})})]}),a&&e.jsxs("div",{className:"p-6 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Status do Backend"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>v(!c),className:`px-3 py-1 rounded-lg text-sm font-medium transition-colors ${c?"bg-[#FD5521] text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"}`,children:c?"ðŸ”„ Auto":"Manual"}),e.jsx("button",{onClick:i,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400",title:"Atualizar agora",children:e.jsx(R,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-lg ${a.overall==="healthy"?"bg-green-100 dark:bg-green-900/30":a.overall==="degraded"?"bg-yellow-100 dark:bg-yellow-900/30":"bg-red-100 dark:bg-red-900/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.overall==="healthy"?e.jsx(m,{className:"w-5 h-5 text-green-600 dark:text-green-400"}):a.overall==="degraded"?e.jsx(D,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"}):e.jsx(k,{className:"w-5 h-5 text-red-600 dark:text-red-400"}),e.jsx("span",{className:`text-sm font-medium ${a.overall==="healthy"?"text-green-700 dark:text-green-400":a.overall==="degraded"?"text-yellow-700 dark:text-yellow-400":"text-red-700 dark:text-red-400"}`,children:a.overall==="healthy"?"SaudÃ¡vel":a.overall==="degraded"?"Degradado":"Fora do ar"})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Status Geral"})]}),Object.entries({edgeFunctions:"Edge Functions",auth:"Auth",database:"Database",storage:"Storage"}).map(([t,d])=>{const l=a.checks[t];return e.jsxs("div",{className:`p-4 rounded-lg ${l?"bg-green-50 dark:bg-green-900/10":"bg-red-50 dark:bg-red-900/10"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[l?e.jsx(m,{className:"w-4 h-4 text-green-600 dark:text-green-400"}):e.jsx(k,{className:"w-4 h-4 text-red-600 dark:text-red-400"}),e.jsx("span",{className:`text-xs font-medium ${l?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"}`,children:l?"OK":"Erro"})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:d})]},t)})]})]}),e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800 flex flex-wrap gap-2",children:[e.jsx("button",{onClick:C,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium",children:"ðŸ“‹ Ver DiagnÃ³stico"}),e.jsxs("button",{onClick:E,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm font-medium flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4"}),"Exportar JSON"]}),e.jsxs("button",{onClick:S,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-sm font-medium flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4"}),"Exportar CSV"]}),e.jsxs("button",{onClick:w,className:"px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm font-medium flex items-center gap-2 ml-auto",children:[e.jsx(B,{className:"w-4 h-4"}),"Limpar Tudo"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:h.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(m,{className:"w-16 h-16 mx-auto mb-4 text-green-500"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"âœ… Nenhum erro registrado! Sistema funcionando normalmente."})]}):e.jsx("div",{className:"space-y-3",children:h.map((t,d)=>e.jsx("div",{onClick:()=>g(t),className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${b[t.category]}`,children:[u[t.category]," ",t.category]}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(t.timestamp).toLocaleString("pt-BR")})]}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white font-medium mb-1",children:t.message}),t.context&&e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[t.context.url&&e.jsxs("p",{children:["URL: ",t.context.url]}),t.context.statusCode&&e.jsxs("p",{children:["Status: ",t.context.statusCode]}),t.context.method&&e.jsxs("p",{children:["MÃ©todo: ",t.context.method]})]})]})})},d))})}),s&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Detalhes do Erro"}),e.jsx("button",{onClick:()=>g(null),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400",children:e.jsx(p,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Categoria"}),e.jsxs("span",{className:`inline-block px-3 py-1 rounded text-sm font-medium ${b[s.category]}`,children:[u[s.category]," ",s.category]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Timestamp"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:new Date(s.timestamp).toLocaleString("pt-BR")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Mensagem"}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-white font-mono bg-gray-100 dark:bg-gray-800 p-3 rounded",children:s.message})]}),s.stack&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Stack Trace"}),e.jsx("pre",{className:"text-xs text-gray-900 dark:text-white font-mono bg-gray-100 dark:bg-gray-800 p-3 rounded overflow-x-auto",children:s.stack})]}),s.context&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Contexto"}),e.jsx("pre",{className:"text-xs text-gray-900 dark:text-white font-mono bg-gray-100 dark:bg-gray-800 p-3 rounded overflow-x-auto",children:JSON.stringify(s.context,null,2)})]})]})]})})]})})}export{K as ProductionMonitorDashboard};
