import{h as D,r as c,j as e,o as E,F}from"./index-B8AJ77RJ.js";import{s as I}from"./emailApi-aU3Tz6Cg.js";import{H as S,S as z}from"./SearchableBottomSheet-C1yLqjBT.js";import{A}from"./arrow-left-DuykKinw.js";import{H as O}from"./hash-CVpZO_we.js";import{U as m}from"./user-round-Cd62TeDe.js";import{B as $}from"./circle-check-big-B6tA49Jg.js";import{M as _}from"./map-pin-DFNYG0Pl.js";import{C as H}from"./calendar-6k61YVon.js";import{C as R}from"./useSafeLogout-CswRB37V.js";import{M}from"./mail-GLqEnMpV.js";import{m as h}from"./proxy-BZL43_Lm.js";import"./react-vendor-7PqXWhc5.js";import"./search-BEGimt_h.js";import"./motion-vendor-B3HUmrK1.js";const ae=({obra:o,users:f,onBack:b,onSuccess:C})=>{const{showToast:d,ToastComponent:y}=D(),v=o.encarregadoId,[a,n]=c.useState({cliente:o.cliente,obra:o.obra,cidade:o.cidade,data:o.data,encarregadoId:o.encarregadoId,prepostoNome:o.prepostoNome||"",prepostoEmail:o.prepostoEmail||""}),[s,w]=c.useState({cliente:!1,obra:!1,cidade:!1,encarregadoId:!1}),[i,p]=c.useState(!1),[N,g]=c.useState(null),u=f.filter(r=>r.tipo==="Encarregado"),x=u.find(r=>r.id===a.encarregadoId),j=async r=>{if(r.preventDefault(),i)return;const l={cliente:!a.cliente.trim(),obra:!a.obra.trim(),cidade:!a.cidade.trim(),encarregadoId:!a.encarregadoId};if(w(l),!(l.cliente||l.obra||l.cidade||l.encarregadoId)){p(!0);try{const t=await E.update(o.id,{cliente:a.cliente,obra:a.obra,cidade:a.cidade,data:a.data,encarregado_id:a.encarregadoId,preposto_nome:a.prepostoNome||void 0,preposto_email:a.prepostoEmail||void 0});if(t.success){const k={...o,cliente:a.cliente,obra:a.obra,cidade:a.cidade,data:a.data,encarregadoId:a.encarregadoId,prepostoNome:a.prepostoNome||void 0,prepostoEmail:a.prepostoEmail||void 0};await F(k),v!==a.encarregadoId&&t.data.encarregado_email&&((await I({encarregadoEmail:t.data.encarregado_email,encarregadoNome:t.data.encarregado_nome||"Encarregado",obraNome:t.data.obra,cliente:t.data.cliente,cidade:t.data.cidade,prepostoNome:t.data.preposto_nome||"Cliente",obraId:t.data.id})).success||d("⚠️ Obra atualizada mas houve erro ao enviar email ao encarregado","warning")),d("Obra atualizada com sucesso!","success"),setTimeout(()=>{C()},1e3)}else d(`Erro ao atualizar obra: ${t.error}`,"error")}catch(t){console.error("❌ Erro ao atualizar obra:",t),d(`Erro ao atualizar obra: ${t.message}`,"error")}finally{p(!1)}}};return e.jsxs(h.div,{initial:{opacity:0,x:"100%"},animate:{opacity:1,x:0},exit:{opacity:0,x:"100%"},transition:{duration:.3,ease:[.4,0,.2,1]},className:"fixed inset-0 bg-background z-50 flex flex-col",children:[e.jsx("header",{className:"bg-white dark:bg-gray-900",children:e.jsxs("div",{className:"px-4 py-4 flex items-center gap-3",children:[e.jsx("button",{onClick:b,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full text-gray-600 dark:text-gray-400",children:e.jsx(A,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Editar Obra"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-[#EDEFE4] dark:bg-gray-900",children:e.jsxs("form",{onSubmit:j,className:"max-w-3xl mx-auto p-4 space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-[#C6CCC2] pointer-events-none"}),e.jsx("input",{type:"text",value:`#${String(o.id).slice(-5)}`,disabled:!0,className:`w-full pl-12 pr-4 py-3 rounded-xl \r
                       bg-[#DDE1D7] dark:bg-gray-800 text-gray-500 dark:text-gray-400`})]}),e.jsxs("div",{className:"relative group",children:[e.jsx(m,{className:"absolute left-4 top-3.5 w-5 h-5 text-[#C6CCC2] pointer-events-none transition-colors group-focus-within:text-[#FD5521] dark:group-focus-within:text-[#FD5521]"}),e.jsx("input",{type:"text",value:a.cliente,onChange:r=>n({...a,cliente:r.target.value}),placeholder:"Cliente *",className:`w-full pl-12 pr-4 py-3 rounded-xl 
                       bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                       border border-transparent dark:border-gray-800
                       placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                       focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                       ${s.cliente?"ring-2 ring-red-500":""}`}),s.cliente&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Campo obrigatório"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx($,{className:"absolute left-4 top-3.5 w-5 h-5 text-[#C6CCC2] pointer-events-none transition-colors group-focus-within:text-[#FD5521] dark:group-focus-within:text-[#FD5521]"}),e.jsx("input",{type:"text",value:a.obra,onChange:r=>n({...a,obra:r.target.value}),placeholder:"Obra *",className:`w-full pl-12 pr-4 py-3 rounded-xl 
                       bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                       border border-transparent dark:border-gray-800
                       placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                       focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                       ${s.obra?"ring-2 ring-red-500":""}`}),s.obra&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Campo obrigatório"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx(_,{className:"absolute left-4 top-3.5 w-5 h-5 text-[#C6CCC2] pointer-events-none transition-colors group-focus-within:text-[#FD5521] dark:group-focus-within:text-[#FD5521]"}),e.jsx("input",{type:"text",value:a.cidade,onChange:r=>n({...a,cidade:r.target.value}),placeholder:"Cidade *",className:`w-full pl-12 pr-4 py-3 rounded-xl 
                       bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                       border border-transparent dark:border-gray-800
                       placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                       focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                       ${s.cidade?"ring-2 ring-red-500":""}`}),s.cidade&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Campo obrigatório"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx(H,{className:"absolute left-4 top-3.5 w-5 h-5 text-[#C6CCC2] pointer-events-none transition-colors group-focus-within:text-[#FD5521] dark:group-focus-within:text-[#FD5521]"}),e.jsx("input",{type:"date",value:a.data,onChange:r=>n({...a,data:r.target.value}),className:`w-full pl-12 pr-4 py-3 rounded-xl \r
                       bg-white dark:bg-gray-800 text-gray-900 dark:text-white\r
                       border border-transparent dark:border-gray-800\r
                       focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40`})]}),e.jsxs("div",{className:"relative group",children:[e.jsx(S,{className:"absolute left-4 top-3.5 w-5 h-5 text-[#C6CCC2] pointer-events-none z-10 transition-colors group-focus-within:text-[#FD5521] dark:group-focus-within:text-[#FD5521]"}),e.jsxs("button",{type:"button",onClick:()=>g("encarregado"),className:`w-full pl-12 pr-4 py-3 rounded-xl 
                       bg-white dark:bg-gray-800 text-left flex items-center justify-between
                       border border-transparent dark:border-gray-800
                       focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                       ${s.encarregadoId?"ring-2 ring-red-500":""}`,children:[e.jsx("span",{className:x?"text-gray-900 dark:text-white":"text-[#C6CCC2] dark:text-gray-600",children:x?.nome||"Encarregado *"}),e.jsx(R,{className:"w-5 h-5 text-gray-400"})]}),s.encarregadoId&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Campo obrigatório"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx(m,{className:"absolute left-4 top-3.5 w-5 h-5 text-[#C6CCC2] pointer-events-none transition-colors group-focus-within:text-[#FD5521] dark:group-focus-within:text-[#FD5521]"}),e.jsx("input",{type:"text",value:a.prepostoNome,onChange:r=>n({...a,prepostoNome:r.target.value}),placeholder:"Nome do Preposto",className:`w-full pl-12 pr-4 py-3 rounded-xl \r
                       bg-white dark:bg-gray-800 text-gray-900 dark:text-white\r
                       border border-transparent dark:border-gray-800\r
                       placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500\r
                       focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40`})]}),e.jsxs("div",{className:"relative group",children:[e.jsx(M,{className:"absolute left-4 top-3.5 w-5 h-5 text-[#C6CCC2] pointer-events-none transition-colors group-focus-within:text-[#FD5521] dark:group-focus-within:text-[#FD5521]"}),e.jsx("input",{type:"email",value:a.prepostoEmail,onChange:r=>n({...a,prepostoEmail:r.target.value}),placeholder:"Email do Preposto",className:`w-full pl-12 pr-4 py-3 rounded-xl \r
                       bg-white dark:bg-gray-800 text-gray-900 dark:text-white\r
                       border border-transparent dark:border-gray-800\r
                       placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500\r
                       focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40`})]}),e.jsxs("button",{type:"submit",disabled:i,className:`relative w-full px-6 py-3 rounded-xl text-white font-medium mt-4 overflow-hidden transition-colors
                       ${i?"bg-[#E54A1D] cursor-not-allowed":"bg-[#FD5521] hover:bg-[#E54A1D]"}`,children:[i&&e.jsx(h.div,{className:"absolute inset-0 bg-[#D4441A]",initial:{x:"-100%"},animate:{x:"100%"},transition:{duration:1.5,repeat:1/0,ease:"linear"}}),e.jsx("span",{className:"relative z-10",children:i?"Salvando alterações...":"Salvar Alterações"})]})]})}),e.jsx(z,{isOpen:N==="encarregado",onClose:()=>g(null),title:"Selecione o Encarregado",options:u.map(r=>({id:r.id,label:r.nome,sublabel:r.email||r.telefone})),selectedId:a.encarregadoId,onSelect:r=>n({...a,encarregadoId:r})}),y]})};export{ae as default};
