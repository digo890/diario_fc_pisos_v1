import{$ as n,a0 as w,E as c}from"./index-B8AJ77RJ.js";async function i(a,r=3,e=1e3,o=!0,t){for(let s=1;s<=r;s++)try{return await a()}catch(f){if(s===r)throw f;const p=o?e*Math.pow(2,s-1):e;await new Promise(h=>setTimeout(h,p))}throw new Error("Retry failed")}const u=`https://${w}.supabase.co/functions/v1/make-server-1ff231a2`;async function l(a){try{const r=await i(async()=>{const e=n();if(!e)throw new Error("Usuário não autenticado");const t=await(await fetch(`${u}/emails/send-preposto-conferencia`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`,"X-User-Token":e},body:JSON.stringify(a)})).json();if(!t.success)throw new Error(t.error||"Erro ao enviar email");return t});return{success:!0}}catch(r){return console.error("❌ Erro ao enviar email ao preposto após 3 tentativas:",r),{success:!1,error:r.message}}}async function y(a){try{return await i(async()=>{const r=n();if(!r)throw new Error("Usuário não autenticado");const o=await(await fetch(`${u}/emails/send-encarregado-nova-obra`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`,"X-User-Token":r},body:JSON.stringify(a)})).json();if(!o.success)throw new Error(o.error||"Erro ao enviar email");return o}),{success:!0}}catch(r){return console.error("❌ Erro ao enviar email ao encarregado após 3 tentativas:",r),{success:!1,error:r.message}}}export{l as a,y as s};
