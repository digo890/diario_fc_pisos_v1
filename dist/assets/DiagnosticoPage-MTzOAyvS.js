import{c as u,u as h,r as s,j as e,E as p}from"./index-B8AJ77RJ.js";import{L as y}from"./lock-DvTB73o1.js";import{S as i}from"./search-BEGimt_h.js";import"./react-vendor-7PqXWhc5.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],k=u("shield-alert",f),D=()=>{const{currentUser:o,accessToken:c,isLoading:x}=h(),[a,g]=s.useState(""),[r,d]=s.useState(null),[n,l]=s.useState(!1);if(x)return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-500",children:"Verificando permiss√µes..."})});if(!o||o.tipo!=="Administrador")return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950 flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl p-8 max-w-md w-full text-center shadow-xl",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(y,{className:"w-8 h-8 text-red-600 dark:text-red-400"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Acesso Negado"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Esta p√°gina √© restrita a administradores. Seu acesso n√£o est√° autorizado."}),e.jsx("button",{onClick:()=>window.location.href="/",className:"px-6 py-2 bg-gray-900 dark:bg-white text-white dark:text-gray-900 rounded-lg hover:opacity-90 transition-all font-medium",children:"Voltar ao In√≠cio"})]})});const m=async()=>{if(a.trim()){l(!0);try{const b=await(await fetch(`https://cjwuooaappcnsqxgdpta.supabase.co/functions/v1/make-server-1ff231a2/debug/token/${a}`,{headers:{Authorization:`Bearer ${p}`,"X-User-Token":c||""}})).json();d(b)}catch(t){d({error:String(t)})}finally{l(!1)}}};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950 p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx(i,{className:"w-7 h-7 text-[#FD5521]"}),"Diagn√≥stico de Token"]}),e.jsxs("div",{className:"px-3 py-1 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 rounded-full text-xs font-bold border border-amber-200 dark:border-amber-800 flex items-center gap-1",children:[e.jsx(k,{className:"w-3 h-3"}),"MODO ADMINISTRADOR"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Token de Valida√ß√£o (ID do Formul√°rio)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:a,onChange:t=>g(t.target.value),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-[#FD5521]/40 focus:border-[#FD5521] outline-none",placeholder:"Cole o ID do formul√°rio aqui..."}),e.jsxs("button",{onClick:m,disabled:n||!a.trim(),className:"px-6 py-2 bg-[#FD5521] text-white rounded-lg hover:bg-[#E54A1D] disabled:opacity-50 flex items-center gap-2 transition-all shadow-md",children:[e.jsx(i,{className:"w-5 h-5"}),n?"Buscando...":"Diagnosticar"]})]})]}),r&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"üìä Resultado do Diagn√≥stico"}),e.jsx("pre",{className:"bg-gray-100 dark:bg-gray-900 p-4 rounded-lg overflow-auto text-sm text-gray-800 dark:text-gray-200 border border-gray-200 dark:border-gray-700",children:JSON.stringify(r,null,2)}),r.obra_encontrada!==void 0&&e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("div",{className:`p-3 rounded-lg ${r.obra_encontrada?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300"}`,children:[e.jsx("strong",{children:r.obra_encontrada?"‚úÖ Obra encontrada":"‚ùå Obra N√ÉO encontrada"}),r.obra_encontrada&&e.jsxs("p",{className:"text-sm mt-1",children:["ID: ",r.obra_id," | Status: ",r.obra_status]})]}),e.jsx("div",{className:`p-3 rounded-lg ${r.formulario_encontrado?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300"}`,children:e.jsx("strong",{children:r.formulario_encontrado?"‚úÖ Formul√°rio encontrado":"‚ùå Formul√°rio N√ÉO encontrado"})}),e.jsxs("div",{className:"p-3 rounded-lg bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"üìä Total de obras:"}),e.jsx("span",{className:"font-bold",children:r.total_obras})]}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{children:"üìã Total de formul√°rios:"}),e.jsx("span",{className:"font-bold",children:r.total_formularios})]})]}),!r.formulario_encontrado&&r.obra_encontrada&&e.jsxs("div",{className:"p-4 rounded-lg bg-yellow-100 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-800",children:[e.jsx("strong",{className:"text-yellow-800 dark:text-yellow-400",children:"‚ö†Ô∏è PROBLEMA IDENTIFICADO:"}),e.jsxs("p",{className:"text-yellow-700 dark:text-yellow-300 mt-2 text-sm",children:["A obra existe, mas o formul√°rio n√£o foi criado no backend.",e.jsx("br",{}),'Isso acontece quando o encarregado clica em "Enviar para preposto" sem ter salvo o formul√°rio antes ou se houve erro de rede persistente.']})]})]})]})]})})};export{D as default};
