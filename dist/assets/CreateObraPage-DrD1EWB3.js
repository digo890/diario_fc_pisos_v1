import{h as k,r as l,j as e,o as j,F as D}from"./index-B8AJ77RJ.js";import{s as E}from"./emailApi-aU3Tz6Cg.js";import{H as F,S as _}from"./SearchableBottomSheet-C1yLqjBT.js";import{A as I}from"./arrow-left-DuykKinw.js";import{U as m}from"./user-round-Cd62TeDe.js";import{B as S}from"./circle-check-big-B6tA49Jg.js";import{M as O}from"./map-pin-DFNYG0Pl.js";import{C as A}from"./calendar-6k61YVon.js";import{C as T}from"./useSafeLogout-CswRB37V.js";import{M as $}from"./mail-GLqEnMpV.js";import{m as f}from"./proxy-BZL43_Lm.js";import"./react-vendor-7PqXWhc5.js";import"./search-BEGimt_h.js";import"./motion-vendor-B3HUmrK1.js";const X=({users:b,onBack:h,onSuccess:C})=>{const{showToast:c}=k(),[a,i]=l.useState({cliente:"",obra:"",cidade:"",data:new Date().toISOString().split("T")[0],encarregadoId:"",prepostoNome:"",prepostoEmail:""}),[s,y]=l.useState({cliente:!1,obra:!1,cidade:!1,encarregadoId:!1,prepostoContato:!1}),[d,p]=l.useState(!1),[v,g]=l.useState(null),u=b.filter(t=>t.tipo==="Encarregado"),x=u.find(t=>t.id===a.encarregadoId),w=async t=>{if(t.preventDefault(),d)return;let n=!1;const o={...s};if(a.cliente?o.cliente=!1:(o.cliente=!0,n=!0),a.obra?o.obra=!1:(o.obra=!0,n=!0),a.cidade?o.cidade=!1:(o.cidade=!0,n=!0),a.encarregadoId?o.encarregadoId=!1:(o.encarregadoId=!0,n=!0),a.prepostoEmail?o.prepostoContato=!1:(o.prepostoContato=!0,n=!0),y(o),!n){p(!0);try{const r=await j.create({cliente:a.cliente,obra:a.obra,cidade:a.cidade,data:a.data,encarregado_id:a.encarregadoId,preposto_nome:a.prepostoNome||void 0,preposto_email:a.prepostoEmail||void 0,status:"novo",progress:0,created_by:"admin"});if(r.success){const N={id:r.data.id,cliente:r.data.cliente,obra:r.data.obra,cidade:r.data.cidade,data:r.data.data,encarregadoId:r.data.encarregado_id,prepostoNome:r.data.preposto_nome,prepostoEmail:r.data.preposto_email,validationToken:r.data.token_validacao,validationTokenExpiry:r.data.token_validacao_expiry?new Date(r.data.token_validacao_expiry).getTime():void 0,status:r.data.status,progress:r.data.progress||0,createdAt:new Date(r.data.created_at).getTime(),createdBy:r.data.created_by};await D(N),r.data.encarregado_email&&((await E({encarregadoEmail:r.data.encarregado_email,encarregadoNome:r.data.encarregado_nome||"Encarregado",obraNome:r.data.obra,cliente:r.data.cliente,cidade:r.data.cidade,prepostoNome:r.data.preposto_nome||"Cliente",obraId:r.data.id})).success||c("⚠️ Obra criada mas houve erro ao enviar email ao encarregado","warning")),C()}else c(`Erro ao criar obra: ${r.error}`,"error")}catch(r){c(`Erro ao criar obra: ${r.message}`,"error")}finally{p(!1)}}};return e.jsxs(f.div,{initial:{opacity:0,x:"100%"},animate:{opacity:1,x:0},exit:{opacity:0,x:"100%"},transition:{duration:.3,ease:[.4,0,.2,1]},className:"fixed inset-0 bg-background z-50 flex flex-col",children:[e.jsx("header",{className:"bg-white dark:bg-gray-900",children:e.jsxs("div",{className:"px-4 py-4 flex items-center gap-3",children:[e.jsx("button",{onClick:h,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full text-gray-600 dark:text-gray-400",children:e.jsx(I,{className:"w-6 h-6"})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Nova Obra"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-[#EDEFE4] dark:bg-gray-900",children:e.jsxs("form",{onSubmit:w,className:"max-w-3xl mx-auto p-4 space-y-3",children:[e.jsxs("div",{className:"relative group",children:[e.jsx(m,{className:"absolute left-4 top-3.5 w-5 h-5 text-[#C6CCC2] pointer-events-none transition-colors group-focus-within:text-[#FD5521] dark:group-focus-within:text-[#FD5521]"}),e.jsx("input",{type:"text",value:a.cliente,onChange:t=>i({...a,cliente:t.target.value}),className:`w-full pl-12 pr-4 py-3 rounded-xl 
                       bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                       border border-transparent dark:border-gray-800
                       placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                       focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                       ${s.cliente?"ring-2 ring-red-500":""}`,placeholder:"Cliente *"}),s.cliente&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Campo obrigatório"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx(S,{className:"absolute left-4 top-3.5 w-5 h-5 text-[#C6CCC2] pointer-events-none transition-colors group-focus-within:text-[#FD5521] dark:group-focus-within:text-[#FD5521]"}),e.jsx("input",{type:"text",value:a.obra,onChange:t=>i({...a,obra:t.target.value}),className:`w-full pl-12 pr-4 py-3 rounded-xl 
                       bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                       border border-transparent dark:border-gray-800
                       placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                       focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                       ${s.obra?"ring-2 ring-red-500":""}`,placeholder:"Obra *"}),s.obra&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Campo obrigatório"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx(O,{className:"absolute left-4 top-3.5 w-5 h-5 text-[#C6CCC2] pointer-events-none transition-colors group-focus-within:text-[#FD5521] dark:group-focus-within:text-[#FD5521]"}),e.jsx("input",{type:"text",value:a.cidade,onChange:t=>i({...a,cidade:t.target.value}),className:`w-full pl-12 pr-4 py-3 rounded-xl 
                       bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                       border border-transparent dark:border-gray-800
                       placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                       focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                       ${s.cidade?"ring-2 ring-red-500":""}`,placeholder:"Cidade *"}),s.cidade&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Campo obrigatório"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx(A,{className:"absolute left-4 top-3.5 w-5 h-5 text-[#C6CCC2] pointer-events-none transition-colors group-focus-within:text-[#FD5521] dark:group-focus-within:text-[#FD5521]"}),e.jsx("input",{type:"date",value:a.data,onChange:t=>i({...a,data:t.target.value}),className:`w-full pl-12 pr-4 py-3 rounded-xl \r
                       bg-white dark:bg-gray-800 text-gray-900 dark:text-white\r
                       border border-transparent dark:border-gray-800\r
                       focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40`})]}),e.jsxs("div",{className:"relative group",children:[e.jsx(F,{className:"absolute left-4 top-3.5 w-5 h-5 text-[#C6CCC2] pointer-events-none z-10 transition-colors group-focus-within:text-[#FD5521] dark:group-focus-within:text-[#FD5521]"}),e.jsxs("button",{type:"button",onClick:()=>g("encarregado"),className:`w-full pl-12 pr-4 py-3 rounded-xl
                       bg-white dark:bg-gray-800 text-left flex items-center justify-between
                       border border-transparent dark:border-gray-800
                       focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                       ${s.encarregadoId?"ring-2 ring-red-500":""}`,children:[e.jsx("span",{className:x?"text-gray-900 dark:text-white":"text-[#C6CCC2] dark:text-gray-600",children:x?.nome||"Encarregado *"}),e.jsx(T,{className:"w-5 h-5 text-gray-400"})]}),s.encarregadoId&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Campo obrigatório"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx(m,{className:"absolute left-4 top-3.5 w-5 h-5 text-[#C6CCC2] pointer-events-none transition-colors group-focus-within:text-[#FD5521] dark:group-focus-within:text-[#FD5521]"}),e.jsx("input",{type:"text",value:a.prepostoNome,onChange:t=>i({...a,prepostoNome:t.target.value}),className:`w-full pl-12 pr-4 py-3 rounded-xl 
                       bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                       border border-transparent dark:border-gray-800
                       placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                       focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40`,placeholder:"Nome do Preposto"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx($,{className:"absolute left-4 top-3.5 w-5 h-5 text-[#C6CCC2] pointer-events-none transition-colors group-focus-within:text-[#FD5521] dark:group-focus-within:text-[#FD5521]"}),e.jsx("input",{type:"email",value:a.prepostoEmail,onChange:t=>i({...a,prepostoEmail:t.target.value}),className:`w-full pl-12 pr-4 py-3 rounded-xl 
                       bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                       border border-transparent dark:border-gray-800
                       placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                       focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40`,placeholder:"Email do Preposto"})]}),e.jsxs("button",{type:"submit",disabled:d,className:`relative w-full px-6 py-3 rounded-xl text-white font-medium mt-4 overflow-hidden transition-colors
                       ${d?"bg-[#E54A1D] cursor-not-allowed":"bg-[#FD5521] hover:bg-[#E54A1D]"}`,children:[d&&e.jsx(f.div,{className:"absolute inset-0 bg-[#D4441A]",initial:{x:"-100%"},animate:{x:"100%"},transition:{duration:1.5,repeat:1/0,ease:"linear"}}),e.jsx("span",{className:"relative z-10",children:d?"Criando obra...":"Criar diário da obra"})]})]})}),e.jsx(_,{isOpen:v==="encarregado",onClose:()=>g(null),title:"Selecione o Encarregado",options:u.map(t=>({id:t.id,label:t.nome,sublabel:t.email||t.telefone})),selectedId:a.encarregadoId,onSelect:t=>i({...a,encarregadoId:t})})]})};export{X as default};
