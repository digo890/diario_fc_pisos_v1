import{c as G,j as e,d as Z,r as u,X as re,R as Te,h as he,M as Me,Y as se,u as $e,Z as Pe,m as R,q as W,F as O,w as q,x as Ie,p as K,o as Ae}from"./index-B8AJ77RJ.js";import{S as oe,C as ne,c as ze}from"./clipboard-b_U0YAL8.js";import{a as _e}from"./emailApi-aU3Tz6Cg.js";import{S as ie,M as Ue,a as Le}from"./useSafeLogout-CswRB37V.js";import{P as le,T as be}from"./trash-2-BZuJ-7VK.js";import{C as J}from"./clock-Cb9u-B34.js";import{A as Be}from"./arrow-left-DuykKinw.js";import{M as Ve}from"./mail-GLqEnMpV.js";import"./react-vendor-7PqXWhc5.js";import"./proxy-BZL43_Lm.js";import"./motion-vendor-B3HUmrK1.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],ce=G("camera",Re);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],fe=G("chevron-down",He);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M16 14v6",key:"1j4efv"}],["path",{d:"M8 14v6",key:"17c4r9"}],["path",{d:"M12 16v6",key:"c8a4gj"}]],ee=G("cloud-rain",We);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],ve=G("copy",Oe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ye=G("send",qe),de=new Map;function Ge(t){const s=Date.now(),r=de.get(t.key)||0,l=s-r;return l>=t.limitMs?(de.set(t.key,s),{allowed:!0,remainingMs:0}):{allowed:!1,remainingMs:t.limitMs-l}}function Qe(t,s){let r=null;return function(...l){r!==null&&clearTimeout(r),r=setTimeout(()=>{t.apply(this,l)},s)}}const Je=({data:t,onChange:s,isReadOnly:r})=>{const l=(c,m)=>{s({clima:{...t.clima,[c]:t.clima[c]===m?void 0:m}})},i=({periodo:c,tipo:m,icon:h,label:o})=>{const j=t.clima[c]===m;return e.jsx("button",{type:"button",onClick:()=>!r&&l(c,m),disabled:r,className:`flex flex-col items-center justify-center p-3 rounded-xl transition-all ${j?"bg-[#FD5521]/10":"bg-[#F9FAF2] dark:bg-gray-700"} ${r?"cursor-default":"cursor-pointer"}`,title:o,children:e.jsx("div",{className:j?"text-[#FD5521]":"text-gray-700 dark:text-gray-400",children:h})})};return e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Condições Ambientais"}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl px-6 py-5",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 w-14 flex-shrink-0",children:"Manhã"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 flex-1",children:[e.jsx(i,{periodo:"manha",tipo:"sol",icon:e.jsx(ie,{className:"w-6 h-6"}),label:"Sol"}),e.jsx(i,{periodo:"manha",tipo:"nublado",icon:e.jsx(Z,{className:"w-6 h-6"}),label:"Nublado"}),e.jsx(i,{periodo:"manha",tipo:"chuva",icon:e.jsx(ee,{className:"w-6 h-6"}),label:"Chuva"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 w-14 flex-shrink-0",children:"Tarde"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 flex-1",children:[e.jsx(i,{periodo:"tarde",tipo:"sol",icon:e.jsx(ie,{className:"w-6 h-6"}),label:"Sol"}),e.jsx(i,{periodo:"tarde",tipo:"nublado",icon:e.jsx(Z,{className:"w-6 h-6"}),label:"Nublado"}),e.jsx(i,{periodo:"tarde",tipo:"chuva",icon:e.jsx(ee,{className:"w-6 h-6"}),label:"Chuva"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 w-14 flex-shrink-0",children:"Noite"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 flex-1",children:[e.jsx(i,{periodo:"noite",tipo:"lua",icon:e.jsx(Ue,{className:"w-6 h-6"}),label:"Céu limpo"}),e.jsx(i,{periodo:"noite",tipo:"nublado",icon:e.jsx(Z,{className:"w-6 h-6"}),label:"Nublado"}),e.jsx(i,{periodo:"noite",tipo:"chuva",icon:e.jsx(ee,{className:"w-6 h-6"}),label:"Chuva"})]})]})]})})]})},te=({isOpen:t,onClose:s,title:r,options:l,selectedId:i,onSelect:c})=>(u.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t]),t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 animate-in fade-in duration-200",onClick:s}),e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-50 animate-in slide-in-from-bottom duration-300",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-t-[20px] shadow-2xl max-h-[80vh] flex flex-col",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-700 rounded-full"})}),e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:r}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full text-gray-500 dark:text-gray-400","aria-label":"Fechar",children:e.jsx(re,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"overflow-y-auto flex-1",children:l.length===0?e.jsx("div",{className:"px-6 py-12 text-center text-gray-500 dark:text-gray-400",children:"Nenhuma opção disponível"}):e.jsx("div",{className:"py-2",children:l.map(m=>e.jsxs("button",{onClick:()=>{c(m.id),s()},className:`w-full px-6 py-4 flex items-center justify-between transition-colors rounded-xl mx-2 mb-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#FD5521]/40 ${i===m.id?"bg-[#FD5521]/10":"bg-white dark:bg-gray-800"}`,children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:`font-medium ${i===m.id?"text-[#FD5521]":"text-gray-900 dark:text-white"}`,children:m.label}),m.sublabel&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:m.sublabel})]}),i===m.id&&e.jsx("div",{className:"w-5 h-5 rounded-full bg-[#FD5521] flex items-center justify-center ml-3",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},m.id))})})]})})]}):null),ue=[{label:"Temperatura Ambiente",unit:"°C"},{label:"Umidade Relativa do Ar",unit:"%"},{label:"Temperatura do Substrato",unit:"°C"},{label:"Umidade Superficial do Substrato",unit:"%"},{label:"Temperatura da Mistura",unit:"°C"},{label:"Tempo de Mistura",unit:"Minutos"},{label:"Nº dos Lotes da Parte 1",unit:""},{label:"Nº dos Lotes da Parte 2",unit:""},{label:"Nº dos Lotes da Parte 3",unit:""},{label:"Nº de Kits Gastos",unit:""},{label:"Consumo Médio Obtido",unit:"m²/Kit"},{label:"Preparo de Substrato (fresagem e ancoragem)",unit:"m²/ml"},{label:"Aplicação de Uretano",unit:"m²",isMultiSelect:!0,options:"ucrete"},{label:"Serviços de pintura",unit:"m²",isMultiSelect:!0,options:"pintura"},{label:"Serviços de pintura de layout",unit:"ml",isMultiSelect:!0,options:"pinturaLayout"},{label:"Aplicação de Epóxi",unit:"m²"},{label:"Corte / Selamento Juntas de Piso",unit:"ml"},{label:"Corte / Selamento Juntas em Muretas",unit:"ml"},{label:"Corte / Selamento Juntas em Rodapés",unit:"ml"},{label:"Remoção de Substrato Fraco",isDualField:!0,units:["m²","cm"]},{label:"Desbaste de Substrato",isDualField:!0,units:["m²","cm"]},{label:"Grauteamento",isDualField:!0,units:["m²","cm"]},{label:"Remoção e Reparo de Sub-Base",isDualField:!0,units:["m²","cm"]},{label:"Reparo com Concreto Uretânico",isDualField:!0,units:["m²","cm"]},{label:"Tratamento de Trincas",unit:"ml"},{label:"Execução de Lábios Poliméricos",unit:"ml"},{label:"Secagem de Substrato",unit:"m²"},{label:"Remoção de Revestimento Antigo",unit:"m²"},{label:"Polimento Mecânico de Substrato",unit:"m²"},{label:"Reparo de Revestimento em Piso",isDualField:!0,units:["m²","cm"]},{label:"Reparo de Revestimento em Muretas",unit:"ml"},{label:"Reparo de Revestimento em Rodapé",unit:"ml"},{label:"Quantos botijões de gás foram utilizados?",unit:""},{label:"Quantas bisnagas de selante foram utilizadas?",unit:""}],xe=["Uretano argamassado 4mm","Uretano argamassado 6mm","Uretano autonivelante","Uretano para rodapé","Uretano para muretas","Uretano para Paredes, base e pilares"],me=["Pintura em isopainel (parede)","Pintura em isopainel (forro)","Pintura em alvenaria"],ge=["Faixas de 10cm","Faixas de 5cm","Faixas de pedestre","Caminho seguro","Desenho de empilhadeira","Desenho de flechas de indicação","Desenho de bonecos","Desenho de extintor/hidrante"],Ye=t=>{let s=t.replace(/[^0-9.,]/g,"");const r=parseFloat(s.replace(",","."));return!isNaN(r)&&r>100?"100":s},Xe=Te.memo(({data:t,onChange:s,isReadOnly:r,isPreposto:l,activeServico:i,setActiveServico:c,onBlur:m})=>{const{showToast:h}=he(),[o,j]=u.useState({servicoKey:null,label:null,type:null}),[f,w]=u.useState({servicoKey:null,label:null}),[S,F]=u.useState({show:!1,servico:null}),M=u.useMemo(()=>{const n=[];return t.servicos?.servico1!==void 0&&t.servicos.servico1!==null&&n.push("servico1"),t.servicos?.servico2!==void 0&&t.servicos.servico2!==null&&n.push("servico2"),t.servicos?.servico3!==void 0&&t.servicos.servico3!==null&&n.push("servico3"),n},[t.servicos]);u.useEffect(()=>{M.length===0&&s({servicos:{servico1:{horarioInicioManha:"",horarioFimManha:"",horarioInicioTarde:"",horarioFimTarde:"",local:"",etapas:{}}}})},[M,s]);const I=()=>{if(r)return;let n=null;t.servicos.servico2?t.servicos.servico3||(n="servico3"):n="servico2",n&&(s({servicos:{...t.servicos,[n]:{horarioInicioManha:"",horarioFimManha:"",horarioInicioTarde:"",horarioFimTarde:"",local:"",etapas:{}}}}),c(n))},y=n=>{r||F({show:!0,servico:n})},D=n=>{const x={};Object.keys(t.servicos).forEach(g=>{if(g!==n){const a=t.servicos[g];x[g]={...a,etapas:{...a.etapas},fotos:a.fotos?[...a.fotos]:void 0,registros:a.registros?{...a.registros}:void 0}}}),s({servicos:x}),i===n&&c("servico1"),F({show:!1,servico:null})},b=(n,x)=>{const g=t.servicos[n]||{horarioInicioManha:"",horarioFimManha:"",horarioInicioTarde:"",horarioFimTarde:"",local:"",etapas:{}},a={horarioInicioManha:x.horarioInicioManha!==void 0?x.horarioInicioManha:g.horarioInicioManha,horarioFimManha:x.horarioFimManha!==void 0?x.horarioFimManha:g.horarioFimManha,horarioInicioTarde:x.horarioInicioTarde!==void 0?x.horarioInicioTarde:g.horarioInicioTarde,horarioFimTarde:x.horarioFimTarde!==void 0?x.horarioFimTarde:g.horarioFimTarde,local:x.local!==void 0?x.local:g.local,etapas:x.etapas!==void 0?{...x.etapas}:{...g.etapas},fotos:x.fotos!==void 0?x.fotos?[...x.fotos]:void 0:g.fotos?[...g.fotos]:void 0};s({servicos:{...t.servicos,[n]:a}})},N=(n,x,g)=>{const p={...(t.servicos[n]||{etapas:{}}).etapas};p[x]=g,b(n,{etapas:p})},$=(n,x,g)=>{const p={...(t.servicos[n]||{etapas:{}}).etapas},d=(p[x]||"").split("|");p[x]=`${g}|${d[1]||""}`,b(n,{etapas:p})},z=(n,x,g)=>{const p={...(t.servicos[n]||{etapas:{}}).etapas},d=(p[x]||"").split("|");p[x]=`${d[0]||""}|${g}`,b(n,{etapas:p})},E=(n,x)=>(t.servicos[n]?.etapas[x]||"").split("|")[0]||"",H=(n,x)=>(t.servicos[n]?.etapas[x]||"").split("|")[1]||"",L=(n,x)=>{const a=t.servicos[n]?.etapas[x]||"";return a?a.split("|").filter(p=>p).map(p=>{const[v,d]=p.split(":");return{tipo:v||"",valor:d||""}}).filter(p=>p.tipo):[]},C=(n,x)=>L(n,x).map(a=>a.tipo),_=(n,x,g)=>{const p={...(t.servicos[n]||{etapas:{}}).etapas},v=L(n,x);if(v.map(k=>k.tipo).includes(g)){const k=v.filter(P=>P.tipo!==g);p[x]=k.map(P=>`${P.tipo}:${P.valor}`).join("|")}else v.push({tipo:g,valor:""}),p[x]=v.map(k=>`${k.tipo}:${k.valor}`).join("|");b(n,{etapas:p})},B=(n,x,g,a)=>{const v={...(t.servicos[n]||{etapas:{}}).etapas},d=L(n,x),k=d.some(T=>T.tipo===g);let P;k?P=d.map(T=>T.tipo===g?{tipo:g,valor:a}:T):P=[...d,{tipo:g,valor:a}],v[x]=P.map(T=>`${T.tipo}:${T.valor}`).join("|"),b(n,{etapas:v})},Q=n=>{if(!t.servicos.servico1){h("Serviço 1 não possui dados para copiar","warning");return}const x=t.servicos.servico1,g={};x.registros&&Object.keys(x.registros).forEach(a=>{g[a]={...x.registros[a],foto:x.registros[a].foto}}),s({servicos:{...t.servicos,[n]:{horarioInicioManha:x.horarioInicioManha,horarioFimManha:x.horarioFimManha,horarioInicioTarde:x.horarioInicioTarde,horarioFimTarde:x.horarioFimTarde,local:x.local,etapas:{...x.etapas},fotos:x.fotos?[...x.fotos]:void 0,registros:Object.keys(g).length>0?g:void 0}}}),c(n)},U=(n,x)=>{const g=t.servicos[n];return e.jsxs("div",{className:"space-y-6",children:[x>1&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>Q(n),disabled:r,className:`flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg 
                       border-2 border-dashed border-gray-300 dark:border-gray-700
                       text-gray-700 dark:text-gray-300 hover:border-[#FD5521] hover:text-[#FD5521]
                       disabled:opacity-50 disabled:hover:border-gray-300 disabled:hover:text-gray-700`,children:[e.jsx(ve,{className:"w-4 h-4"}),"Copiar dados do Serviço 1"]}),!r&&e.jsx("button",{type:"button",onClick:()=>y(n),className:`px-3 py-2 rounded-lg border-2 border-dashed border-red-300 dark:border-red-900
                         text-red-600 dark:text-red-400 hover:border-red-500 hover:text-red-700
                         dark:hover:border-red-700 dark:hover:text-red-300`,title:"Excluir este serviço",children:e.jsx(be,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Período da Manhã"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Início"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),e.jsx("input",{type:"time",value:g?.horarioInicioManha||"",onChange:a=>b(n,{horarioInicioManha:a.target.value}),disabled:r,className:`w-full pl-12 pr-4 py-3 rounded-xl 
                               bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                               focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                               disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500`})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Fim"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),e.jsx("input",{type:"time",value:g?.horarioFimManha||"",onChange:a=>b(n,{horarioFimManha:a.target.value}),disabled:r,className:`w-full pl-12 pr-4 py-3 rounded-xl 
                               bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                               focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                               disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500`})]})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Período da Tarde"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Início"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),e.jsx("input",{type:"time",value:g?.horarioInicioTarde||"",onChange:a=>b(n,{horarioInicioTarde:a.target.value}),disabled:r,className:`w-full pl-12 pr-4 py-3 rounded-xl 
                               bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                               focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                               disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500`})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:"Fim"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),e.jsx("input",{type:"time",value:g?.horarioFimTarde||"",onChange:a=>b(n,{horarioFimTarde:a.target.value}),disabled:r,className:`w-full pl-12 pr-4 py-3 rounded-xl 
                               bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                               focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                               disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500`})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Local de execução"}),e.jsx("input",{type:"text",value:g?.local||"",onChange:a=>b(n,{local:a.target.value}),disabled:r,placeholder:r?"":"Ex: Galpão A, Área externa",className:`w-full px-4 py-3 rounded-xl 
                     bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                     placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                     focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                     disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500`})]}),e.jsx("div",{children:e.jsx("div",{className:"space-y-3",children:ue.map((a,p)=>{const v=p+1;return a.options,a.options,e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-700 dark:text-gray-300 mb-1",children:[e.jsxs("span",{className:"text-[#C6CCC2] dark:text-gray-500",children:[v,"."]})," ",a.label]}),a.isDropdown?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>{r||j({servicoKey:n,label:a.label,type:a.options})},disabled:r,className:`w-1/2 px-4 py-3 rounded-lg 
                                 bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                                 focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                                 disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500
                                 flex items-center justify-between`,children:[e.jsx("span",{className:`truncate ${E(n,a.label)?"":"text-[#C6CCC2] dark:text-gray-500"}`,children:E(n,a.label)||(r?"":"Selecione")}),e.jsx(fe,{className:"w-4 h-4 text-gray-400"})]}),e.jsxs("div",{className:"relative w-1/2",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:H(n,a.label),onChange:d=>{const k=d.target.value.replace(/[^0-9.,/-]/g,"");z(n,a.label,k)},disabled:r,placeholder:r?"":"Digite o valor",className:`w-full px-4 py-3 pr-12 rounded-lg 
                                   bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                                   placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                                   focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                                   disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500`}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 pointer-events-none text-sm",children:a.unit})]})]}):a.isMultiSelect?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{type:"button",onClick:()=>{r||w({servicoKey:n,label:a.label})},disabled:r,className:`w-full px-4 py-3 rounded-lg 
                                 bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                                 focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                                 disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500
                                 flex items-center justify-between transition-colors`,children:[e.jsx("span",{className:C(n,a.label).length>0?"":"text-[#C6CCC2] dark:text-gray-500",children:C(n,a.label).length>0?`${C(n,a.label).length} tipo(s) selecionado(s)`:r?"":"Selecione os tipos"}),e.jsx(le,{className:"w-4 h-4 text-gray-400"})]}),L(n,a.label).map((d,k)=>{let P=a.unit,T=!1;return a.label==="Aplicação de Uretano"&&(d.tipo==="Uretano para rodapé"||d.tipo==="Uretano para muretas"||d.tipo==="Uretano para Paredes, base e pilares"||d.tipo==="Uretano para Paredes"?(P="ml",T=!0):P="m²"),e.jsxs("div",{className:"pl-4 border-l-2 border-[#FD5521]",children:[e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1",children:d.tipo==="Uretano para Paredes"?"Uretano para Paredes, base e pilares":d.tipo}),T?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative w-1/2",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:(d.valor||"").split("~")[0]||"",onChange:A=>{const V=A.target.value.replace(/[^0-9.,/-]/g,""),ae=(d.valor||"").split("~"),X=`${V}~${ae[1]||""}`;B(n,a.label,d.tipo,X)},disabled:r,placeholder:r?"":"Valor",className:`w-full px-4 py-3 pr-12 rounded-lg 
                                             bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                                             placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                                             focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                                             disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500`}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 pointer-events-none text-sm",children:"ml"})]}),e.jsxs("div",{className:"relative w-1/2",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:(d.valor||"").split("~")[1]||"",onChange:A=>{const V=A.target.value.replace(/[^0-9.,/-]/g,""),X=`${(d.valor||"").split("~")[0]||""}~${V}`;B(n,a.label,d.tipo,X)},disabled:r,placeholder:r?"":"Valor",className:`w-full px-4 py-3 pr-12 rounded-lg 
                                             bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                                             placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                                             focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                                             disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500`}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 pointer-events-none text-sm",children:"cm"})]})]}):e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:d.valor,onChange:A=>{const V=A.target.value.replace(/[^0-9.,/-]/g,"");B(n,a.label,d.tipo,V)},disabled:r,placeholder:r?"":"Digite o valor",className:`w-full px-4 py-3 pr-12 rounded-lg 
                                           bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                                           placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                                           focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                                           disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500`}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 pointer-events-none text-sm",children:P})]})]},k)})]}):a.isDualField?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative w-1/2",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:(g?.etapas[a.label]||"").split("|")[0]||"",onChange:d=>{const k=d.target.value.replace(/[^0-9.,/-]/g,""),T=(g?.etapas[a.label]||"").split("|"),A=`${k}|${T[1]||""}`;N(n,a.label,A)},disabled:r,placeholder:r?"":"Valor",className:`w-full px-4 py-3 pr-12 rounded-lg 
                                   bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                                   placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                                   focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                                   disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500`}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 pointer-events-none text-sm",children:a.units?.[0]})]}),e.jsxs("div",{className:"relative w-1/2",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:(g?.etapas[a.label]||"").split("|")[1]||"",onChange:d=>{const k=d.target.value.replace(/[^0-9.,/-]/g,""),A=`${(g?.etapas[a.label]||"").split("|")[0]||""}|${k}`;N(n,a.label,A)},disabled:r,placeholder:r?"":"Valor",className:`w-full px-4 py-3 pr-12 rounded-lg 
                                   bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                                   placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                                   focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                                   disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500`}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 pointer-events-none text-sm",children:a.units?.[1]})]})]}):a.unit?e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:g?.etapas[a.label]||"",onChange:d=>{let k=d.target.value.replace(/[^0-9.,/-]/g,"");a.unit==="%"&&(k=Ye(k)),N(n,a.label,k)},disabled:r,placeholder:r?"":"Digite o valor",className:`w-full px-4 py-3 pr-24 rounded-xl 
                                 bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                                 placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                                 focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                                 disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500`}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 pointer-events-none text-sm",children:a.unit})]}):e.jsx("input",{type:"text",inputMode:"decimal",value:g?.etapas[a.label]||"",onChange:d=>{const k=d.target.value.replace(/[^0-9.,/-]/g,"");N(n,a.label,k)},disabled:r,placeholder:r?"":"Digite o valor",className:`w-full px-4 py-3 rounded-xl 
                               bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                               placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                               focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                               disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500`})]},p)})})})]})};return e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Serviços Executados"}),!r&&!l&&e.jsxs("button",{type:"button",onClick:I,className:`flex items-center gap-1 text-sm font-medium transition-colors
                     text-[#FD5521] hover:text-[#FD5521]/80`,children:[e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Adicionar Serviço"})]})]}),M.length>1&&e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-800 mb-6",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("button",{type:"button",onClick:()=>c("servico1"),className:`pb-3 px-1 border-b-2 font-medium transition-colors ${i==="servico1"?"border-[#FD5521] text-[#FD5521]":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"Serviço 1"}),M.includes("servico2")&&e.jsx("button",{type:"button",onClick:()=>c("servico2"),className:`pb-3 px-1 border-b-2 font-medium transition-colors ${i==="servico2"?"border-[#FD5521] text-[#FD5521]":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"Serviço 2"}),M.includes("servico3")&&e.jsx("button",{type:"button",onClick:()=>c("servico3"),className:`pb-3 px-1 border-b-2 font-medium transition-colors ${i==="servico3"?"border-[#FD5521] text-[#FD5521]":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"Serviço 3"})]})}),i==="servico1"&&U("servico1",1),i==="servico2"&&U("servico2",2),i==="servico3"&&U("servico3",3),S.show&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:()=>F({show:!1,servico:null}),children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm mx-4",onClick:n=>n.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Confirmar Exclusão"}),e.jsxs("p",{className:"text-gray-700 dark:text-gray-300 mb-6",children:["Deseja remover o ",S.servico==="servico2"?"Serviço 2":"Serviço 3","? Todos os dados serão perdidos."]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>F({show:!1,servico:null}),className:`px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700
                         text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-900
                         transition-colors`,children:"Cancelar"}),e.jsx("button",{type:"button",onClick:()=>D(S.servico),className:`px-4 py-2 rounded-lg bg-red-500 dark:bg-red-700
                         text-white hover:bg-red-600 dark:hover:bg-red-800
                         transition-colors`,children:"Excluir"})]})]})}),o.type==="ucrete"&&e.jsx(te,{isOpen:!!o.servicoKey,onClose:()=>j({servicoKey:null,label:null,type:null}),title:"Selecione o tipo",options:xe.map(n=>({id:n,label:n})),selectedId:E(o.servicoKey,o.label),onSelect:n=>{$(o.servicoKey,o.label,n),j({servicoKey:null,label:null,type:null})}},`ucrete-${o.servicoKey}`),o.type==="pintura"&&e.jsx(te,{isOpen:!!o.servicoKey,onClose:()=>j({servicoKey:null,label:null,type:null}),title:"Selecione o tipo",options:me.map(n=>({id:n,label:n})),selectedId:E(o.servicoKey,o.label),onSelect:n=>{$(o.servicoKey,o.label,n),j({servicoKey:null,label:null,type:null})}},`pintura-${o.servicoKey}`),o.type==="pinturaLayout"&&e.jsx(te,{isOpen:!!o.servicoKey,onClose:()=>j({servicoKey:null,label:null,type:null}),title:"Selecione o tipo",options:ge.map(n=>({id:n,label:n})),selectedId:E(o.servicoKey,o.label),onSelect:n=>{$(o.servicoKey,o.label,n),j({servicoKey:null,label:null,type:null})}},`pinturaLayout-${o.servicoKey}`),f.servicoKey&&f.label&&(()=>{const x=ue.find(p=>p.label===f.label)?.options||"ucrete";let g=xe,a="Selecione os tipos de uretano";return x==="pintura"?(g=me,a="Selecione os tipos de pintura"):x==="pinturaLayout"&&(g=ge,a="Selecione os tipos de pintura de layout"),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 p-4",onClick:()=>w({servicoKey:null,label:null}),children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl max-w-md w-full max-h-[80vh] overflow-hidden flex flex-col",onClick:p=>p.stopPropagation(),children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white text-center",children:a})}),e.jsx("div",{className:"p-4 space-y-2 overflow-y-auto flex-1",children:g.map(p=>{const d=C(f.servicoKey,f.label).includes(p);return e.jsxs("button",{type:"button",onClick:()=>{_(f.servicoKey,f.label,p)},className:`w-full px-4 py-3 rounded-lg flex items-center justify-between
                               bg-gray-50 dark:bg-gray-900 hover:bg-gray-100 dark:hover:bg-gray-800
                               transition-colors`,children:[e.jsx("span",{className:"text-gray-900 dark:text-white",children:p}),e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center transition-colors ${d?"bg-[#FD5521] border-[#FD5521]":"border-gray-300 dark:border-gray-600"}`,children:d&&e.jsx("svg",{className:"w-3 h-3 text-white",viewBox:"0 0 12 12",fill:"none",children:e.jsx("path",{d:"M10 3L4.5 8.5L2 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]},p)})}),e.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{type:"button",onClick:()=>w({servicoKey:null,label:null}),className:`w-full py-3 rounded-lg bg-[#FD5521] text-white font-medium
                           hover:bg-[#FD5521]/90 transition-colors`,children:"Concluir"})})]})})})()]})}),Ze=["Uretano MF","Uretano DP 10","Uretano DP 20","Uretano IF","Outro"],Ke=["Sem rodapé","5 cm","10 cm","15 cm","20 cm","Outro"],et=["Fraco","Irregular/Ondulado","Bom estado"],tt=({data:t,onChange:s,isReadOnly:r})=>{const[l,i]=u.useState(!1),[c,m]=u.useState(!1),[h,o]=u.useState(!1),j=({isOpen:f,onClose:w,options:S,value:F,onSelect:M,title:I})=>f?e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end",onClick:w,children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-t-xl w-full max-h-[80vh] overflow-y-auto",onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 p-4",children:[e.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-700 rounded-full mx-auto mb-4"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:I})]}),e.jsx("div",{className:"p-4",children:S.map(y=>e.jsx("button",{onClick:()=>{M(y),w()},className:`w-full text-left px-4 py-3 rounded-xl mb-2 transition-colors ${F===y?"bg-[#FD5521]/10 text-[#FD5521] font-medium":"bg-[#F9FAF2] dark:bg-gray-800 text-gray-900 dark:text-white"}`,children:y},y))})]})}):null;return e.jsxs("section",{children:[e.jsx(j,{isOpen:l,onClose:()=>i(!1),options:Ze,value:t.ucrete,onSelect:f=>s({ucrete:f}),title:"Selecione o tipo de Uretano"}),e.jsx(j,{isOpen:c,onClose:()=>m(!1),options:Ke,value:t.rodape,onSelect:f=>s({rodape:f}),title:"Selecione o rodapé"}),e.jsx(j,{isOpen:h,onClose:()=>o(!1),options:et,value:t.estadoSubstrato,onSelect:f=>s({estadoSubstrato:f}),title:"Selecione o estado do substrato"})]})},rt=["Constatou-se água / umidade no substrato?","As áreas estavam com fechamento lateral?","Estado do substrato","Existe contaminações / crostas / incrustações no substrato?","Há concreto remontado sobre os bordos de ralos / canaletas / trilhos (ml)?","Há ralos / canaletas / trilhos desnivelados em relação ao substrato (ml)?","O boleado de rodapés / muretas foi executado com concreto?","Qual a espessura do piso de concreto?","Qual a profundidade dos cortes das juntas serradas?","As juntas serradas do piso foram aprofundadas por corte adicional? Em que extensão (ml)?","Existem juntas de dilatação no substrato (ml)?","As muretas estão ancoradas no piso?","Existem muretas apoiadas sobre juntas de dilatação no piso?","Existem juntas com bordas esborcinadas (ml)?","Existem trincas no substrato (ml)?","Existem serviços adicionais a serem realizados?","Os serviços adicionais foram liberados pela contratante?","O preposto acompanhou e conferiu as medições?","As áreas concluídas foram protegidas e isoladas?","O substrato foi fotografado?","Ocorreu alguma desconformidade durante ou após as aplicações?","Você relatou ao preposto as desconformidades?"],at=["Fraco","Irregular / Ondulado","Bom Estado"],st=({data:t,onChange:s,isReadOnly:r,activeServico:l})=>{const i=u.useRef({}),[c,m]=u.useState(!1),[h,o]=u.useState(null),f=t.servicos[l]?.registros||{},w=(y,D)=>{const b=t.servicos[l]||{horarioInicioManha:"",horarioFimManha:"",horarioInicioTarde:"",horarioFimTarde:"",local:"",etapas:{},registros:{}};s({servicos:{...t.servicos,[l]:{...b,registros:{...b.registros,[y]:{...b.registros?.[y],...D}}}}})},S=y=>{if(f[y]?.ativo){const b=t.servicos[l]||{horarioInicioManha:"",horarioFimManha:"",horarioInicioTarde:"",horarioFimTarde:"",local:"",etapas:{},registros:{}},N={...b.registros};delete N[y],s({servicos:{...t.servicos,[l]:{...b,registros:N}}})}else w(y,{ativo:!0,texto:"",foto:void 0})},F=async(y,D)=>{if(!D)return;const b=new FileReader;b.onloadend=()=>{w(y,{foto:b.result}),o({key:y,src:b.result})},b.readAsDataURL(D)},M=y=>{w(y,{foto:void 0}),o(null)},I=({isOpen:y,onClose:D,options:b,value:N,onSelect:$,title:z})=>y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 animate-in fade-in duration-200",onClick:D}),e.jsx("div",{className:"fixed inset-x-0 bottom-0 z-50 animate-in slide-in-from-bottom duration-300",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-t-[20px] shadow-2xl max-h-[80vh] flex flex-col",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-2",children:e.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-700 rounded-full"})}),e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-800",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white text-center",children:z})}),e.jsx("div",{className:"overflow-y-auto flex-1 py-2",children:b.map(E=>e.jsxs("button",{onClick:()=>{$(E),D()},className:`w-full px-6 py-4 flex items-center justify-between transition-colors rounded-xl mx-2 mb-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#FD5521]/40 ${N===E?"bg-[#FD5521]/10":"bg-white dark:bg-gray-800"}`,children:[e.jsx("div",{className:`font-medium ${N===E?"text-[#FD5521]":"text-gray-900 dark:text-white"}`,children:E}),N===E&&e.jsx("div",{className:"w-5 h-5 rounded-full bg-[#FD5521] flex items-center justify-center ml-3",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},E))})]})})]}):null;return e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Estado do Substrato"}),e.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-xl overflow-hidden",children:rt.map((y,D)=>{const b=`registro-${D}`,N=f[b],$=N?.ativo||!1,z=D===2,E=D===7,H=D===8,L=D%2===0;return e.jsx("div",{className:L?"bg-white dark:bg-gray-900":"bg-[#F9FAF2] dark:bg-gray-800",children:e.jsx("div",{className:"p-4",children:z?e.jsxs("div",{children:[e.jsxs("label",{className:"block font-medium text-gray-900 dark:text-white mb-3",children:[e.jsxs("span",{className:"text-[#C6CCC2] dark:text-gray-500",children:[35+D,"."]})," ",y]}),e.jsxs("button",{type:"button",onClick:()=>!r&&m(!0),disabled:r,className:`w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-700
                               bg-white dark:bg-gray-800 text-left flex items-center justify-between
                               focus:ring-2 focus:ring-[#FD5521]/40 focus:border-transparent
                               disabled:cursor-not-allowed`,children:[e.jsx("span",{className:N?.texto?"text-gray-900 dark:text-white":"text-[#C6CCC2] dark:text-gray-500",children:N?.texto||(r?"":"Selecione")}),e.jsx(fe,{className:"w-5 h-5 text-gray-400"})]}),N?.texto&&e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx("textarea",{value:N.comentario||"",onChange:C=>w(b,{comentario:C.target.value}),disabled:r,placeholder:r?"":"Descreva detalhes sobre o estado do substrato...",rows:3,className:`w-full px-4 py-3 rounded-xl 
                                 bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                                 focus:outline-none
                                 disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500
                                 resize-none`}),N.foto?e.jsx("img",{src:N.foto,alt:"Registro",loading:"lazy",decoding:"async",className:"w-[72px] h-[72px] object-cover rounded-lg border border-gray-300 dark:border-gray-700 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>o({key:b,src:N.foto})}):!r&&e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:C=>i.current[b]=C,type:"file",accept:"image/*",capture:"environment",onChange:C=>F(b,C.target.files?.[0]||null),className:"hidden"}),e.jsxs("button",{type:"button",onClick:()=>i.current[b]?.click(),className:`flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-dashed 
                                         border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300
                                         hover:border-[#FD5521] hover:text-[#FD5521]`,children:[e.jsx(ce,{className:"w-4 h-4"}),"Anexar foto"]})]})]})]}):E?e.jsxs("div",{children:[e.jsxs("label",{className:"block font-medium text-gray-900 dark:text-white mb-3",children:[e.jsxs("span",{className:"text-[#C6CCC2] dark:text-gray-500",children:[35+D,"."]})," ",y]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",value:N?.espessura||"",onChange:C=>{const _=C.target.value;_===""?w(b,{espessura:null}):w(b,{espessura:parseFloat(_)})},disabled:r,placeholder:r?"":"Digite a espessura",className:`w-full px-4 py-3 pr-12 rounded-lg border-0
                                 bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                                 placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                                 focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                                 disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500`}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 pointer-events-none text-sm",children:"cm"})]})]}):H?e.jsxs("div",{children:[e.jsxs("label",{className:"block font-medium text-gray-900 dark:text-white mb-3",children:[e.jsxs("span",{className:"text-[#C6CCC2] dark:text-gray-500",children:[35+D,"."]})," ",y]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:N?.texto||"",onChange:C=>{const _=C.target.value;/^[0-9.,/\\-]*$/.test(_)&&w(b,{texto:_})},disabled:r,placeholder:r?"":"Digite a profundidade",className:`w-full px-4 py-3 pr-12 rounded-lg border border-gray-300 dark:border-gray-700 
                                 bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                                 placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                                 focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                                 disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500`}),e.jsx("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 pointer-events-none text-sm",children:"cm"})]}),e.jsx("textarea",{value:N?.comentario||"",onChange:C=>w(b,{comentario:C.target.value}),disabled:r,placeholder:r?"":"Observações adicionais...",rows:3,className:`w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-700 
                               bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                               placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                               focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                               disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500
                               resize-none mt-3`})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("label",{className:"font-medium text-gray-900 dark:text-white",children:[e.jsxs("span",{className:"text-[#C6CCC2] dark:text-gray-500",children:[35+D,"."]})," ",y]})}),e.jsxs("div",{className:`bg-[#edefe3] rounded-full p-1 relative w-full sm:w-auto ${L?"dark:bg-gray-800":"dark:bg-gray-900"}`,children:[e.jsx("div",{className:`absolute top-1 bottom-1 left-1 right-1 w-[calc(50%-4px)] bg-[#DBEA8D] dark:bg-[#DBEA8D] rounded-full transition-transform duration-300 ease-in-out ${$?"translate-x-full":"translate-x-0"}`}),e.jsxs("div",{className:"relative flex",children:[e.jsx("button",{type:"button",onClick:()=>!r&&$&&S(b),disabled:r,className:`w-1/2 px-5 py-2.5 rounded-full text-xs font-bold transition-opacity duration-300 disabled:cursor-not-allowed z-10 ${$?"text-black dark:text-gray-400 opacity-40":"text-black opacity-100"}`,children:"Não"}),e.jsx("button",{type:"button",onClick:()=>!r&&!$&&S(b),disabled:r,className:`w-1/2 px-5 py-2.5 rounded-full text-xs font-bold transition-opacity duration-300 disabled:cursor-not-allowed z-10 ${$?"text-black opacity-100":"text-black dark:text-gray-400 opacity-40"}`,children:"Sim"})]})]})]}),$&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("textarea",{value:N.texto,onChange:C=>w(b,{texto:C.target.value}),disabled:r,placeholder:r?"":"Descreva detalhes sobre este registro...",rows:3,className:`w-full px-4 py-3 rounded-xl 
                                   bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                                   focus:outline-none
                                   disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500
                                   resize-none`}),N.foto?e.jsx("img",{src:N.foto,alt:"Registro",loading:"lazy",decoding:"async",className:"w-[72px] h-[72px] object-cover rounded-lg border border-gray-300 dark:border-gray-700 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>o({key:b,src:N.foto})}):!r&&e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:C=>i.current[b]=C,type:"file",accept:"image/*",capture:"environment",onChange:C=>F(b,C.target.files?.[0]||null),className:"hidden"}),e.jsxs("button",{type:"button",onClick:()=>i.current[b]?.click(),className:`flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-dashed 
                                         border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-300
                                         hover:border-[#FD5521] hover:text-[#FD5521]`,children:[e.jsx(ce,{className:"w-4 h-4"}),"Anexar foto"]})]})]})]})})},b)})}),e.jsx(I,{isOpen:c,onClose:()=>m(!1),options:at,value:f["registro-2"]?.texto||"",onSelect:y=>w("registro-2",{texto:y}),title:"Selecione o estado do substrato"}),h&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",onClick:()=>o(null),children:e.jsxs("div",{className:"relative max-w-4xl max-h-[90vh] w-full h-full flex items-center justify-center p-4",children:[e.jsx("button",{onClick:()=>o(null),className:"absolute top-4 right-4 p-2 rounded-full bg-gray-900/80 text-white hover:bg-gray-800 transition-colors z-10",children:e.jsx(re,{className:"w-6 h-6"})}),!r&&e.jsxs("button",{onClick:y=>{y.stopPropagation(),M(h.key)},className:"absolute top-4 left-4 p-2 rounded-full bg-red-500 text-white hover:bg-red-600 transition-colors z-10 flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),e.jsx("span",{className:"pr-2",children:"Excluir"})]}),e.jsx("img",{src:h.src,alt:"Preview",className:"max-w-full max-h-full object-contain rounded-lg",onClick:y=>y.stopPropagation()})]})})]})},ot=({data:t,onChange:s,isReadOnly:r})=>(t.observacoes,e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Observações Gerais"}),e.jsx("textarea",{value:t.observacoes||"",onChange:l=>s({observacoes:l.target.value}),disabled:r,placeholder:r?"":"Adicione observações gerais sobre o trabalho executado, condições especiais, ocorrências ou qualquer informação relevante...",rows:6,className:`w-full px-4 py-3 rounded-xl 
                 bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                 placeholder:text-[#C6CCC2] dark:placeholder:text-gray-500
                 focus:outline-none focus:ring-2 focus:ring-[#FD5521]/40
                 disabled:bg-gray-100 dark:disabled:bg-gray-900 disabled:text-gray-500
                 resize-none`})]}));function nt(t,s,{checkForDefaultPrevented:r=!0}={}){return function(i){if(t?.(i),r===!1||!i.defaultPrevented)return s?.(i)}}function pe(t,s){if(typeof t=="function")return t(s);t!=null&&(t.current=s)}function je(...t){return s=>{let r=!1;const l=t.map(i=>{const c=pe(i,s);return!r&&typeof c=="function"&&(r=!0),c});if(r)return()=>{for(let i=0;i<l.length;i++){const c=l[i];typeof c=="function"?c():pe(t[i],null)}}}}function we(...t){return u.useCallback(je(...t),t)}function it(t,s=[]){let r=[];function l(c,m){const h=u.createContext(m),o=r.length;r=[...r,m];const j=w=>{const{scope:S,children:F,...M}=w,I=S?.[t]?.[o]||h,y=u.useMemo(()=>M,Object.values(M));return e.jsx(I.Provider,{value:y,children:F})};j.displayName=c+"Provider";function f(w,S){const F=S?.[t]?.[o]||h,M=u.useContext(F);if(M)return M;if(m!==void 0)return m;throw new Error(`\`${w}\` must be used within \`${c}\``)}return[j,f]}const i=()=>{const c=r.map(m=>u.createContext(m));return function(h){const o=h?.[t]||c;return u.useMemo(()=>({[`__scope${t}`]:{...h,[t]:o}}),[h,o])}};return i.scopeName=t,[l,lt(i,...s)]}function lt(...t){const s=t[0];if(t.length===1)return s;const r=()=>{const l=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(c){const m=l.reduce((h,{useScope:o,scopeName:j})=>{const w=o(c)[`__scope${j}`];return{...h,...w}},{});return u.useMemo(()=>({[`__scope${s.scopeName}`]:m}),[m])}};return r.scopeName=s.scopeName,r}var ke=globalThis?.document?u.useLayoutEffect:()=>{},ct=Me[" useInsertionEffect ".trim().toString()]||ke;function dt({prop:t,defaultProp:s,onChange:r=()=>{},caller:l}){const[i,c,m]=ut({defaultProp:s,onChange:r}),h=t!==void 0,o=h?t:i;{const f=u.useRef(t!==void 0);u.useEffect(()=>{const w=f.current;w!==h&&console.warn(`${l} is changing from ${w?"controlled":"uncontrolled"} to ${h?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),f.current=h},[h,l])}const j=u.useCallback(f=>{if(h){const w=xt(f)?f(t):f;w!==t&&m.current?.(w)}else c(f)},[h,t,c,m]);return[o,j]}function ut({defaultProp:t,onChange:s}){const[r,l]=u.useState(t),i=u.useRef(r),c=u.useRef(s);return ct(()=>{c.current=s},[s]),u.useEffect(()=>{i.current!==r&&(c.current?.(r),i.current=r)},[r,i]),[r,l,c]}function xt(t){return typeof t=="function"}function mt(t){const s=u.useRef({value:t,previous:t});return u.useMemo(()=>(s.current.value!==t&&(s.current.previous=s.current.value,s.current.value=t),s.current.previous),[t])}function gt(t){const[s,r]=u.useState(void 0);return ke(()=>{if(t){r({width:t.offsetWidth,height:t.offsetHeight});const l=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const c=i[0];let m,h;if("borderBoxSize"in c){const o=c.borderBoxSize,j=Array.isArray(o)?o[0]:o;m=j.inlineSize,h=j.blockSize}else m=t.offsetWidth,h=t.offsetHeight;r({width:m,height:h})});return l.observe(t,{box:"border-box"}),()=>l.unobserve(t)}else r(void 0)},[t]),s}function pt(t){const s=ht(t),r=u.forwardRef((l,i)=>{const{children:c,...m}=l,h=u.Children.toArray(c),o=h.find(ft);if(o){const j=o.props.children,f=h.map(w=>w===o?u.Children.count(j)>1?u.Children.only(null):u.isValidElement(j)?j.props.children:null:w);return e.jsx(s,{...m,ref:i,children:u.isValidElement(j)?u.cloneElement(j,void 0,f):null})}return e.jsx(s,{...m,ref:i,children:c})});return r.displayName=`${t}.Slot`,r}function ht(t){const s=u.forwardRef((r,l)=>{const{children:i,...c}=r;if(u.isValidElement(i)){const m=yt(i),h=vt(c,i.props);return i.type!==u.Fragment&&(h.ref=l?je(l,m):m),u.cloneElement(i,h)}return u.Children.count(i)>1?u.Children.only(null):null});return s.displayName=`${t}.SlotClone`,s}var bt=Symbol("radix.slottable");function ft(t){return u.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===bt}function vt(t,s){const r={...s};for(const l in s){const i=t[l],c=s[l];/^on[A-Z]/.test(l)?i&&c?r[l]=(...h)=>{const o=c(...h);return i(...h),o}:i&&(r[l]=i):l==="style"?r[l]={...i,...c}:l==="className"&&(r[l]=[i,c].filter(Boolean).join(" "))}return{...t,...r}}function yt(t){let s=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,r=s&&"isReactWarning"in s&&s.isReactWarning;return r?t.ref:(s=Object.getOwnPropertyDescriptor(t,"ref")?.get,r=s&&"isReactWarning"in s&&s.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var jt=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ne=jt.reduce((t,s)=>{const r=pt(`Primitive.${s}`),l=u.forwardRef((i,c)=>{const{asChild:m,...h}=i,o=m?r:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(o,{...h,ref:c})});return l.displayName=`Primitive.${s}`,{...t,[s]:l}},{}),Y="Switch",[wt]=it(Y),[kt,Nt]=wt(Y),Ce=u.forwardRef((t,s)=>{const{__scopeSwitch:r,name:l,checked:i,defaultChecked:c,required:m,disabled:h,value:o="on",onCheckedChange:j,form:f,...w}=t,[S,F]=u.useState(null),M=we(s,N=>F(N)),I=u.useRef(!1),y=S?f||!!S.closest("form"):!0,[D,b]=dt({prop:i,defaultProp:c??!1,onChange:j,caller:Y});return e.jsxs(kt,{scope:r,checked:D,disabled:h,children:[e.jsx(Ne.button,{type:"button",role:"switch","aria-checked":D,"aria-required":m,"data-state":Ee(D),"data-disabled":h?"":void 0,disabled:h,value:o,...w,ref:M,onClick:nt(t.onClick,N=>{b($=>!$),y&&(I.current=N.isPropagationStopped(),I.current||N.stopPropagation())})}),y&&e.jsx(De,{control:S,bubbles:!I.current,name:l,value:o,checked:D,required:m,disabled:h,form:f,style:{transform:"translateX(-100%)"}})]})});Ce.displayName=Y;var Se="SwitchThumb",Fe=u.forwardRef((t,s)=>{const{__scopeSwitch:r,...l}=t,i=Nt(Se,r);return e.jsx(Ne.span,{"data-state":Ee(i.checked),"data-disabled":i.disabled?"":void 0,...l,ref:s})});Fe.displayName=Se;var Ct="SwitchBubbleInput",De=u.forwardRef(({__scopeSwitch:t,control:s,checked:r,bubbles:l=!0,...i},c)=>{const m=u.useRef(null),h=we(m,c),o=mt(r),j=gt(s);return u.useEffect(()=>{const f=m.current;if(!f)return;const w=window.HTMLInputElement.prototype,F=Object.getOwnPropertyDescriptor(w,"checked").set;if(o!==r&&F){const M=new Event("click",{bubbles:l});F.call(f,r),f.dispatchEvent(M)}},[o,r,l]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...i,tabIndex:-1,ref:h,style:{...i.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});De.displayName=Ct;function Ee(t){return t?"checked":"unchecked"}var St=Ce,Ft=Fe;function Dt({className:t,...s}){return e.jsx(St,{"data-slot":"switch",className:se("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(Ft,{"data-slot":"switch-thumb",className:se("bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const Et=({data:t,onChange:s,onSubmit:r,isSubmitting:l})=>e.jsx("section",{className:"bg-white dark:bg-gray-900 rounded-xl p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Confirmar Diário de Obra"}),e.jsxs("label",{className:`flex items-start gap-3 cursor-pointer group p-4 rounded-lg 
                         bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 
                         transition-colors`,children:[e.jsx(Dt,{checked:t.prepostoConfirmado||!1,onCheckedChange:i=>s({prepostoConfirmado:i}),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:`font-medium text-gray-900 dark:text-white group-hover:text-[#FD5521] 
                         dark:group-hover:text-[#FD5521] transition-colors`,children:"Li e conferi cuidadosamente todas as informações"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2 leading-relaxed",children:"Ao marcar esta opção e enviar o formulário, você está confirmando que revisou todos os dados preenchidos pelo encarregado e que as informações estão corretas e completas."})]})]}),r&&e.jsxs("button",{onClick:r,disabled:!t.prepostoConfirmado||l,className:`w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg 
                     bg-[#FD5521] text-white hover:bg-[#E54A1D] 
                     disabled:opacity-50 disabled:cursor-not-allowed
                     transition-all duration-200 font-medium`,children:[e.jsx(ye,{className:"w-5 h-5"}),l?"Enviando...":"Enviar para FC Pisos"]})]})}),Vt=({obra:t,isReadOnly:s,isPreposto:r,onBack:l})=>{const{currentUser:i}=$e(),{showToast:c,ToastComponent:m}=he(),{checkSession:h}=Pe(),[o,j]=u.useState(null),[f,w]=u.useState(!0),[S,F]=u.useState(!1),[M,I]=u.useState("servico1"),[y,D]=u.useState(!1),[b,N]=u.useState(!1),[$,z]=u.useState("idle"),[E,H]=u.useState(!1),L=a=>{const p=new Date(a),v=String(p.getDate()).padStart(2,"0"),d=String(p.getMonth()+1).padStart(2,"0"),k=String(p.getFullYear()).slice(-2);return`${v}/${d}/${k}`},C=u.useCallback(async(a,p=!1)=>{if(!p&&!E){R("⏭️ Auto-save ignorado: sem mudanças (isDirty=false)");return}if(S){R("⏭️ Auto-save ignorado: já está salvando");return}if(a)try{F(!0),z("saving");const v=Date.now(),d={...a,updatedAt:Date.now()};if(await W(d),t.status==="novo"&&(d.clima&&Object.keys(d.clima).length>0||d.temperaturaMin||d.temperaturaMax||d.umidade||d.servicos&&Object.keys(d.servicos).length>0||d.ucrete||d.horarioInicio||d.horarioTermino||d.area||d.espessura||d.rodape||d.estadoSubstrato||d.estadoSubstratoObs||d.registros&&Object.keys(d.registros).length>0||d.observacoes)){const T={...t,status:"em_preenchimento",updatedAt:Date.now()};await O(T),R('✅ Status da obra atualizado para "em_preenchimento"')}const k=Date.now()-v;k<300&&await new Promise(P=>setTimeout(P,300-k)),R("💾 Auto-save: formulário salvo localmente"),z("saved"),H(!1),F(!1)}catch(v){q("❌ Erro no auto-save:",v),z("idle"),F(!1)}},[E,S,t]),_=u.useRef(Qe(a=>C(a),600)).current,B=u.useCallback(()=>{o&&!S&&!f&&E&&C(o)},[o,S,f,E,C]);u.useEffect(()=>{let a=!1;return(async()=>{let v=await Ie(t.id);v||(v={obra_id:t.id,clima:{},temperaturaMin:"",temperaturaMax:"",umidade:"",servicos:{},ucrete:"",horarioInicio:"",horarioTermino:"",area:"",espessura:"",rodape:"",estadoSubstrato:"",estadoSubstratoObs:"",registros:{},observacoes:"",status:"novo",createdAt:Date.now(),updatedAt:Date.now(),createdBy:i?.id||""},await W(v)),a||(j(v),w(!1))})(),()=>{a=!0}},[]),u.useEffect(()=>{!o||S||f||!E||_(o)},[o,S,f,E,_]),u.useEffect(()=>{if($==="saved"){const a=setTimeout(()=>{z("idle")},3e3);return()=>clearTimeout(a)}},[$]);const Q=async()=>{if(!o||S)return;const a=await h();if(!a.isValid){c(a.message||"Sessão expirada","error");return}const p=Ge({key:`enviar-preposto-${t.id}`,limitMs:6e4});if(!p.allowed){const v=Math.ceil(p.remainingMs/1e3);c(`Aguarde ${v}s para reenviar`,"warning");return}F(!0);try{if(r){if(!o.prepostoConfirmado){c("É necessário confirmar a conferência antes de enviar","warning"),F(!1);return}const v={...o,status:"concluido",prepostoReviewedAt:Date.now(),prepostoReviewedBy:i?.id,updatedAt:Date.now()};await W(v),await O({...t,status:"concluido",progress:100}),c("Formulário enviado para o administrador com sucesso!","success"),setTimeout(()=>{l()},1500)}else{const v={...o,status:"enviado_preposto",enviadoPrepostoAt:Date.now(),updatedAt:Date.now()};await W(v);const d={...t,status:"enviado_preposto"};await O(d);try{if(navigator.onLine){let k;try{const T=await K.list(),A=T.success?T.data?.find(V=>V.obra_id===t.id):null;if(A)k=A.id,await K.update(k,{...v,obra_id:t.id}),R("✅ Formulário atualizado no backend");else{k=crypto.randomUUID();const V={id:k,obra_id:t.id,...v};await K.create(V),R(`✅ Formulário criado no backend com ID: ${k}`)}}catch(T){throw q("❌ Erro ao sincronizar formulário:",T),T}if(!k)throw new Error("ID do formulário não foi gerado corretamente");await Ae.update(t.id,{status:"enviado_preposto",progress:t.progress||0}),R("✅ Status sincronizado com backend: enviado_preposto");let P=!1;if(t.prepostoEmail){R("📧 Iniciando envio de email para preposto...");const T=await _e({prepostoEmail:t.prepostoEmail,prepostoNome:t.prepostoNome||"Preposto",formularioId:k,obraNome:t.obra,cliente:t.cliente,cidade:t.cidade,encarregadoNome:i?.nome||"Encarregado"});T.success?(R("✅ Email enviado com sucesso ao preposto"),P=!0):(q("⚠️ Erro ao enviar email ao preposto:",T.error),c("⚠️ Formulário enviado, mas houve erro ao enviar email. Por favor, envie o link manualmente.","warning"))}F(!1),P&&t.prepostoEmail?c("Formulário enviado e email enviado ao preposto ✓","success"):c("Formulário enviado! Compartilhe o link de validação com o preposto.","success"),setTimeout(()=>{l()},1500)}else{c("Sem conexão com a internet. Por favor, conecte-se e tente novamente.","error"),await W(o),await O(t),F(!1);return}}catch(k){q("❌ Erro crítico ao sincronizar com backend:",k),await W(o),await O(t),c("Erro ao sincronizar com servidor. Tente novamente em alguns instantes.","error"),F(!1);return}}}catch(v){q("❌ Erro ao enviar formulário:",v),c("Erro ao enviar formulário. Tente novamente.","error"),F(!1)}},U=a=>{if(!o)return;const p={...o};a.servicos&&(p.servicos=a.servicos,Object.keys(a.servicos).forEach(v=>{const d=v;a.servicos[d]&&(p.servicos[d]={...a.servicos[d],etapas:{...a.servicos[d].etapas},fotos:a.servicos[d].fotos?[...a.servicos[d].fotos]:void 0})})),a.registros&&(p.registros={...a.registros}),a.clima&&(p.clima={...a.clima}),Object.keys(a).forEach(v=>{v!=="servicos"&&v!=="registros"&&v!=="clima"&&(p[v]=a[v])}),j(p),H(!0)},n=u.useCallback(async a=>{o&&E&&await C(o,!0),I(a)},[o,E,C]),x=u.useCallback(async()=>{o&&E&&await C(o,!0),l()},[o,E,C,l]);if(u.useEffect(()=>{const a=async p=>{o&&E&&!s&&(await C(o,!0),p.preventDefault(),p.returnValue="")};return window.addEventListener("beforeunload",a),()=>{window.removeEventListener("beforeunload",a)}},[o,E,s,C]),f)return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-900 dark:text-white",children:"Carregando formulário..."})});if(!o)return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-900 dark:text-white",children:"Erro ao carregar formulário"})});const g=Le(t,o);return e.jsxs("div",{className:"min-h-screen bg-background",children:[m,S&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl p-8 shadow-2xl flex flex-col items-center gap-4 max-w-sm mx-4",children:[e.jsxs("svg",{className:"animate-spin h-12 w-12 text-[#FD5521]",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-1",children:"Enviando formulário..."}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Por favor, aguarde"})]})]})}),e.jsx("header",{className:"bg-white dark:bg-gray-900",children:e.jsx("div",{className:"max-w-3xl mx-auto px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:x,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg text-gray-600 dark:text-gray-400",children:e.jsx(Be,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[t.cliente," - ",t.obra]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 flex items-center gap-2 flex-wrap",children:[e.jsx("span",{children:t.cidade}),e.jsx("span",{children:"•"}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${g.color}`,children:g.label}),o.createdAt&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:L(o.createdAt)})]})]})]}),t.status==="enviado_preposto"&&t.validationToken&&!r&&e.jsx("button",{onClick:()=>D(!0),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg text-[#FD5521] transition-colors",title:"Compartilhar link de validação",children:e.jsx(oe,{className:"w-5 h-5"})})]})})}),e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6 pb-24",children:[!s&&!r&&$!=="idle"&&e.jsx("div",{className:`fixed bottom-20 right-4 px-4 py-2 rounded-full shadow-lg transition-all duration-300 flex items-center gap-2 ${$==="saving"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300":"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300"}`,children:$==="saving"?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"text-sm font-medium",children:"Salvando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Salvo automaticamente"})]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsx(Je,{data:o,onChange:U,isReadOnly:s||r,onBlur:B}),e.jsx(Xe,{data:o,onChange:U,isReadOnly:s||r,isPreposto:r,activeServico:M,setActiveServico:n,onBlur:B}),e.jsx(tt,{data:o,onChange:U,isReadOnly:s||r,onBlur:B}),e.jsx(st,{data:o,onChange:U,isReadOnly:s||r,activeServico:M,onBlur:B}),e.jsx(ot,{data:o,onChange:U,isReadOnly:s||r,onBlur:B}),r&&e.jsx(Et,{data:o,onChange:U,onSubmit:Q,isSubmitting:S}),!s&&!r&&e.jsx("button",{onClick:Q,disabled:S,className:`w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg 
                       bg-[#FD5521] text-white hover:bg-[#E54A1D] disabled:opacity-50 transition-all`,children:S?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-5 h-5"}),"Enviar para Preposto"]})})]})]}),y&&t.validationToken&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl max-w-md w-full p-6 relative",children:[e.jsx("button",{onClick:()=>D(!1),className:"absolute top-4 right-4 p-2 rounded-lg text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:e.jsx(re,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-[#FD5521]/10 rounded-full flex items-center justify-center",children:e.jsx(oe,{className:"w-6 h-6 text-[#FD5521]"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Compartilhar com Preposto"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.prepostoNome||"Cliente"})]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:"Caso o envio automático não tenha funcionado, você pode reenviar manualmente:"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Link de Validação"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:`${window.location.origin}/conferencia/${t.validationToken}`,className:"flex-1 px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-white text-sm"}),e.jsx("button",{onClick:async()=>{await ze(`${window.location.origin}/conferencia/${t.validationToken}`)?(N(!0),setTimeout(()=>N(!1),2e3),c("Link copiado! ✓","success")):c("Não foi possível copiar. Por favor, selecione e copie o texto manualmente.","warning")},className:"px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-800 text-gray-900 dark:text-white hover:bg-gray-300 dark:hover:bg-gray-700 transition-colors",children:b?e.jsx(ne,{className:"w-5 h-5 text-green-500"}):e.jsx(ve,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"space-y-2",children:t.prepostoEmail&&e.jsxs("a",{href:`mailto:${t.prepostoEmail}?subject=${encodeURIComponent(`Conferência de Formulário - ${t.cliente}`)}&body=${encodeURIComponent(`Olá!

Segue o link para conferência do formulário da obra ${t.cliente} - ${t.obra}:

${window.location.origin}/conferencia/${t.validationToken}

Atenciosamente,
FC Pisos`)}`,className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-lg bg-blue-500 text-white hover:bg-blue-600 transition-colors",children:[e.jsx(Ve,{className:"w-5 h-5"}),"Enviar via Email"]})})]})})]})};export{Vt as default};
